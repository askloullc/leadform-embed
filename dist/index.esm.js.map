{"version":3,"sources":["../src/types.ts","../src/simple-form.tsx","../src/index.ts"],"sourcesContent":["export type LeadFormWidgetConfig = LeadFormConfig & {\n  position: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left' | 'center'\n  closeButtonLabel?: string\n}\n\nexport interface LeadFormConfig {\n  // payload\n  siteSlug: string\n  sitePublicKey: string\n  // UI\n  theme: 'light' | 'dark' | 'auto'\n  fields: string[]\n  title: string | undefined\n  buttonText: string\n  successMessage: string\n  requireConsent: boolean\n  requireMarketingConsent: boolean\n  accentColorHex: string\n  subtitle?: string | undefined\n  nameFieldLabel?: string\n  emailFieldLabel?: string\n  companyFieldLabel?: string\n  phoneFieldLabel?: string\n  messageFieldLabel?: string\n  nameFieldPlaceholder?: string\n  emailFieldPlaceholder?: string\n  companyFieldPlaceholder?: string\n  phoneFieldPlaceholder?: string\n  messageFieldPlaceholder?: string\n  successTitle?: string\n  successSubtitle?: string\n  // non adjustable by clients\n  apiEndpoint?: string\n}\n\nexport interface LeadFormData {\n  name?: string\n  email?: string\n  company?: string\n  message?: string\n  phone?: string\n  consent?: string\n  marketingConsent?: string\n  [key: string]: string | undefined\n}\n\nexport interface ConsentEvent {\n  timestamp: string\n  ip?: string\n  userAgent: string\n  consentText: string\n  consentGiven: boolean\n  marketingConsentRequested: boolean\n  marketingConsentText: string | undefined\n  marketingConsentGiven: boolean | undefined\n}\n\nexport interface DeviceFingerprint {\n  screen: string\n  timezone: string\n  language: string\n  platform: string\n  cookieEnabled: boolean\n  doNotTrack: string | null\n}\n\nexport interface CaptureLeadPayload {\n  siteSlug: string\n  sitePublicKey: string\n  formData: LeadFormData\n  consentEvent: ConsentEvent | null\n  deviceFingerprint: DeviceFingerprint\n  source: 'embed' | 'react-form'\n  submissionTime: number | null\n  userAgent: string\n  timestamp: string\n  url: string\n  idempotencyKey: string\n}\n\nexport const consentText =\n  'We value your privacy. By submitting this form, you consent to us storing your details for the purpose of responding to your request.'\nexport const marketingConsentText =\n  'I agree to receive marketing communications relevant to my request. I understand I can unsubscribe at any time.'\n\nexport const generateIdempotencyKey = (): string => {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n}\n\n// Email validation function\nexport function validateEmail(email: string): boolean {\n  if (!email || email.trim() === '') {\n    return false\n  }\n\n  // Basic RFC 5322 compliant email regex\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  return emailRegex.test(email.trim())\n}\n\n// Phone validation function\nexport function validatePhone(phone: string): boolean {\n  if (!phone || phone.trim() === '') {\n    return false\n  }\n\n  // Remove all non-digit characters except + for international prefix\n  const cleanPhone = phone.replace(/[^\\d+]/g, '')\n\n  // Extract digits only for length validation\n  const digits = cleanPhone.replace(/[^\\d]/g, '')\n\n  // Check length constraints\n  if (digits.length < 10 || digits.length > 15) {\n    return false\n  }\n\n  // Validate different phone number formats\n  let isValid = false\n\n  if (digits.length === 10) {\n    // US domestic format validation (area code can't start with 0 or 1)\n    isValid = /^[2-9]\\d{2}[2-9]\\d{6}$/.test(digits)\n  } else if (digits.length === 11 && digits[0] === '1') {\n    // US format with country code\n    isValid = /^1[2-9]\\d{2}[2-9]\\d{6}$/.test(digits)\n  } else if (digits.length >= 11 && digits.length <= 15) {\n    // International format - basic validation\n    isValid = /^\\d{7,15}$/.test(digits)\n  }\n\n  // Additional checks for obviously invalid patterns\n  if (isValid) {\n    // Check for repeated digits (likely fake numbers like 1111111111)\n    if (/^(\\d)\\1{6,}$/.test(digits)) {\n      return false\n    }\n\n    // Check for sequential digits (123456789, 987654321, etc.)\n    const sequentialPatterns = [\n      '012345',\n      '123456',\n      '234567',\n      '345678',\n      '456789',\n      '567890',\n      '654321',\n      '543210',\n      '432109',\n      '321098',\n      '210987',\n      '109876',\n      '098765',\n    ]\n\n    for (const pattern of sequentialPatterns) {\n      if (digits.includes(pattern)) {\n        return false\n      }\n    }\n  }\n\n  return isValid\n}\n","import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n  CaptureLeadPayload,\n  ConsentEvent,\n  consentText,\n  DeviceFingerprint,\n  generateIdempotencyKey,\n  LeadFormConfig,\n  LeadFormData,\n  marketingConsentText,\n  validateEmail,\n  validatePhone,\n} from \"./types\";\n\n// Simplified component props\nexport interface SimpleLeadFormProps extends Partial<LeadFormConfig> {\n  siteSlug: string;\n  sitePublicKey: string;\n  onSubmit?: (data: { data: LeadFormData; result: any }) => void;\n  onError?: (error: { type: string; message: string; error?: any }) => void;\n  className?: string;\n  style?: React.CSSProperties;\n  showSuccessMessage?: boolean;\n  dataTestId?: string;\n  mockSubmit?: boolean;\n}\n\n// Default configuration\nconst DEFAULT_CONFIG: Omit<LeadFormConfig, \"siteSlug\" | \"sitePublicKey\"> = {\n  theme: \"auto\",\n  fields: [\"name\", \"email\", \"message\"],\n  title: \"Get in touch\",\n  subtitle:\n    \"We'd love to hear from you. Send us a message and we'll respond as soon as possible.\",\n  buttonText: \"Send message\",\n  successMessage: \"Thank you! We'll get back to you soon.\",\n  requireConsent: true,\n  requireMarketingConsent: false,\n  accentColorHex: \"#3b82f6\",\n  nameFieldLabel: \"Name\",\n  emailFieldLabel: \"Email\",\n  companyFieldLabel: \"Company\",\n  phoneFieldLabel: \"Phone\",\n  messageFieldLabel: \"Message\",\n  nameFieldPlaceholder: \"Your name\",\n  emailFieldPlaceholder: \"your@email.com\",\n  companyFieldPlaceholder: \"Your company\",\n  phoneFieldPlaceholder: \"Your phone number\",\n  messageFieldPlaceholder: \"Your message...\",\n  successTitle: \"Thank you!\",\n  successSubtitle: \"We'll get back to you as soon as possible.\",\n  apiEndpoint: \"https://api.loubase.com/v1/leads\",\n};\n\n/**\n * SimpleLeadForm - A React component that renders a lead capture form directly\n *\n * This is a simplified version that renders the form inline without any modal\n * or floating behavior. The parent component is responsible for showing/hiding.\n *\n * @example\n * ```tsx\n * import { SimpleLeadForm } from '@loubase/leadform-embed/simple'\n *\n * function ContactPage() {\n *   return (\n *     <div className=\"max-w-md mx-auto\">\n *       <SimpleLeadForm\n *         siteId=\"your-site-id\"\n *         title=\"Contact Us\"\n *         fields={['name', 'email', 'message']}\n *         onSubmit={(data) => console.log('Form submitted:', data)}\n *         onError={(error) => console.error('Form error:', error)}\n *       />\n *     </div>\n *   )\n * }\n * ```\n */\nexport const SimpleLeadForm: React.FC<SimpleLeadFormProps> = ({\n  siteSlug,\n  sitePublicKey,\n  onSubmit,\n  onError,\n  className = \"\",\n  style,\n  showSuccessMessage = true,\n  dataTestId = \"simple-leadform\",\n  mockSubmit = false,\n  ...configOverrides\n}) => {\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});\n  const [formData, setFormData] = useState<LeadFormData>({});\n  const [showMarketingConsent, setShowMarketingConsent] = useState(false);\n  const [submissionStartTime, setSubmissionStartTime] = useState<number | null>(\n    null\n  );\n  const stylesInjectedRef = useRef(false);\n\n  // Merge default config with overrides\n  const config: LeadFormConfig = {\n    ...DEFAULT_CONFIG,\n    siteSlug,\n    sitePublicKey,\n    ...configOverrides,\n  };\n\n  // Inject styles only once\n  useEffect(() => {\n    if (\n      stylesInjectedRef.current ||\n      document.getElementById(\"simple-leadform-styles\")\n    ) {\n      return;\n    }\n\n    const style = document.createElement(\"style\");\n    style.id = \"simple-leadform-styles\";\n    const accentColor = normalizeColor(config.accentColorHex) || \"#3b82f6\";\n\n    style.textContent = `\n      .simple-leadform {\n        --leadform-primary: ${accentColor};\n        --leadform-primary-foreground: #ffffff;\n        --leadform-background: #ffffff;\n        --leadform-foreground: #0f172a;\n        --leadform-muted: #f8fafc;\n        --leadform-muted-foreground: #64748b;\n        --leadform-border: #e2e8f0;\n        --leadform-input: #ffffff;\n        --leadform-ring: var(--leadform-primary);\n        --leadform-destructive: #ef4444;\n        --leadform-destructive-foreground: #ffffff;\n        \n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n        font-size: 14px;\n        line-height: 1.5;\n        color: var(--leadform-foreground);\n        box-sizing: border-box;\n        background: var(--leadform-background);\n        border: 1px solid var(--leadform-border);\n        border-radius: 8px;\n        padding: 24px;\n        max-width: 100%;\n      }\n\n      @media (prefers-color-scheme: dark) {\n        .simple-leadform[data-theme=\"auto\"] {\n          --leadform-background: #0f172a;\n          --leadform-foreground: #f8fafc;\n          --leadform-muted: #1e293b;\n          --leadform-muted-foreground: #94a3b8;\n          --leadform-border: #334155;\n          --leadform-input: #1e293b;\n        }\n      }\n\n      .simple-leadform[data-theme=\"dark\"] {\n        --leadform-background: #0f172a;\n        --leadform-foreground: #f8fafc;\n        --leadform-muted: #1e293b;\n        --leadform-muted-foreground: #94a3b8;\n        --leadform-border: #334155;\n        --leadform-input: #1e293b;\n      }\n\n      .simple-leadform * {\n        box-sizing: border-box;\n      }\n\n      .simple-leadform-header {\n        margin-bottom: 24px;\n        text-align: left;\n      }\n\n      .simple-leadform-title {\n        font-size: 18px;\n        font-weight: 600;\n        margin: 0 0 8px 0;\n        color: var(--leadform-foreground);\n      }\n\n      .simple-leadform-subtitle {\n        font-size: 14px;\n        color: var(--leadform-muted-foreground);\n        margin: 0;\n        line-height: 1.4;\n      }\n\n      .simple-leadform-form {\n        display: flex;\n        flex-direction: column;\n        gap: 20px;\n      }\n\n      .simple-leadform-field {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n\n      .simple-leadform-field.hidden {\n        position: absolute;\n        left: -9999px;\n        opacity: 0;\n        pointer-events: none;\n      }\n\n      .simple-leadform-label {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--leadform-foreground);\n      }\n\n      .simple-leadform-input {\n        padding: 12px 16px;\n        border: 1px solid var(--leadform-border);\n        border-radius: 8px;\n        background: var(--leadform-input);\n        color: var(--leadform-foreground);\n        font-size: 14px;\n        transition: border-color 0.2s ease, box-shadow 0.2s ease;\n      }\n\n      .simple-leadform-input:focus {\n        outline: none;\n        border-color: var(--leadform-ring);\n        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n      }\n\n      .simple-leadform-textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n\n      .simple-leadform-checkbox-field {\n        flex-direction: row;\n        align-items: flex-start;\n        gap: 12px;\n      }\n\n      .simple-leadform-checkbox {\n        margin-top: 2px;\n        width: 16px;\n        height: 16px;\n      }\n\n      .simple-leadform-checkbox-label {\n        font-size: 12px;\n        color: var(--leadform-muted-foreground);\n        line-height: 1.4;\n      }\n\n      .simple-leadform-submit {\n        background: var(--leadform-primary);\n        color: var(--leadform-primary-foreground);\n        border: none;\n        padding: 12px 24px;\n        border-radius: 6px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: background-color 0.2s ease;\n        position: relative;\n        margin-top: 8px;\n      }\n\n      .simple-leadform-submit:hover:not(:disabled) {\n        filter: brightness(0.9);\n      }\n\n      .simple-leadform-submit:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .simple-leadform-submit-loading {\n        color: transparent;\n      }\n\n      .simple-leadform-spinner {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 16px;\n        height: 16px;\n        border: 2px solid transparent;\n        border-top: 2px solid var(--leadform-primary-foreground);\n        border-radius: 50%;\n        animation: simple-leadform-spin 1s linear infinite;\n      }\n\n      @keyframes simple-leadform-spin {\n        0% { transform: translate(-50%, -50%) rotate(0deg); }\n        100% { transform: translate(-50%, -50%) rotate(360deg); }\n      }\n\n      .simple-leadform-success {\n        text-align: center;\n        padding: 20px;\n        color: var(--leadform-foreground);\n      }\n\n      .simple-leadform-error {\n        color: var(--leadform-destructive);\n        font-size: 12px;\n        margin-top: 4px;\n      }\n    `;\n    document.head.appendChild(style);\n    stylesInjectedRef.current = true;\n  }, [config.accentColorHex, config.theme]);\n\n  // Handle form data changes\n  const handleInputChange = useCallback(\n    (field: string, value: string) => {\n      setFormData((prev) => ({ ...prev, [field]: value }));\n\n      // Clear field error when user starts typing\n      if (fieldErrors[field]) {\n        setFieldErrors((prev) => ({ ...prev, [field]: \"\" }));\n      }\n\n      // Show marketing consent when valid email is entered\n      if (field === \"email\" && config.requireMarketingConsent) {\n        const isValidEmail = validateEmail(value);\n        setShowMarketingConsent(isValidEmail);\n      }\n    },\n    [fieldErrors, config.requireMarketingConsent]\n  );\n\n  // Handle form submission\n  const handleSubmit = useCallback(\n    async (e: React.FormEvent) => {\n      e.preventDefault();\n\n      if (isSubmitting) return;\n\n      // Basic validation\n      const errors: Record<string, string> = {};\n      const fieldMap = getFieldMap(config);\n\n      config.fields.forEach((fieldName) => {\n        const field = fieldMap[fieldName];\n        if (field?.required && !formData[fieldName]?.trim()) {\n          errors[fieldName] = `${field.label} is required`;\n        }\n      });\n\n      // Check if either email or phone is present when both fields are in the form\n      const hasEmailField = config.fields.includes(\"email\");\n      const hasPhoneField = config.fields.includes(\"phone\");\n\n      if (hasEmailField && !hasPhoneField) {\n        if (!formData.email?.trim()) {\n          errors.email = \"Email is required\";\n        } else {\n          const isValidEmail = validateEmail(formData.email);\n          if (!isValidEmail) {\n            errors.email = \"Please enter a valid email address\";\n          }\n        }\n      }\n      if (hasPhoneField && !hasEmailField) {\n        if (!formData.phone?.trim()) {\n          errors.phone = \"Phone is required\";\n        } else {\n          const isValidPhone = validatePhone(formData.phone);\n          if (!isValidPhone) {\n            errors.phone = \"Please enter a valid phone number\";\n          }\n        }\n      }\n      if (hasEmailField && hasPhoneField) {\n        // neither filled\n        if (!formData.email?.trim() && !formData.phone?.trim()) {\n          errors.email = \"Email or phone is required\";\n          errors.phone = \"Email or phone is required\";\n          // both filled\n        } else if (formData.email?.trim() && formData.phone?.trim()) {\n          const isValidEmail = validateEmail(formData.email);\n          const isValidPhone = validatePhone(formData.phone);\n          if (!isValidEmail) {\n            errors.email = \"Please enter a valid email address\";\n          }\n          if (!isValidPhone) {\n            errors.phone = \"Please enter a valid phone number\";\n          }\n        } else if (formData.phone?.trim()) {\n          const isValidPhone = validatePhone(formData.phone);\n          if (!isValidPhone) {\n            errors.phone = \"Please enter a valid phone number\";\n          }\n        } else if (formData.email?.trim()) {\n          const isValidEmail = validateEmail(formData.email);\n          if (!isValidEmail) {\n            errors.email = \"Please enter a valid email address\";\n          }\n        }\n      }\n\n      // Check consent if required\n      if (config.requireConsent && formData.consent !== \"true\") {\n        errors.consent = \"Consent is required\";\n      }\n\n      if (Object.keys(errors).length > 0) {\n        setFieldErrors(errors);\n        return;\n      }\n\n      setIsSubmitting(true);\n      setFieldErrors({});\n      setSubmissionStartTime(Date.now());\n\n      try {\n        const response = await submitFormData(\n          config,\n          formData,\n          submissionStartTime,\n          mockSubmit\n        );\n\n        if (showSuccessMessage) {\n          setIsSuccess(true);\n        }\n\n        onSubmit?.({ data: formData, result: response });\n      } catch (error) {\n        const errorData = {\n          type: \"submission\",\n          message: \"Failed to submit form. Please try again.\",\n          error,\n        };\n        onError?.(errorData);\n      } finally {\n        setIsSubmitting(false);\n        setSubmissionStartTime(null);\n      }\n    },\n    [\n      config,\n      formData,\n      isSubmitting,\n      onSubmit,\n      onError,\n      showSuccessMessage,\n      submissionStartTime,\n    ]\n  );\n\n  // Render success state\n  if (isSuccess && showSuccessMessage) {\n    return (\n      <div\n        className={`simple-leadform ${className}`}\n        data-theme={config.theme}\n        data-testid={`${dataTestId}-success`}\n        style={style}\n      >\n        <div className=\"simple-leadform-success\">\n          <svg\n            width=\"48\"\n            height=\"48\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            style={{ margin: \"0 auto 16px\", color: \"#22c55e\" }}\n            data-testid={`${dataTestId}-success-icon`}\n          >\n            <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n            <polyline points=\"22,4 12,14.01 9,11.01\"></polyline>\n          </svg>\n          <h3\n            style={{ margin: \"0 0 8px 0\" }}\n            data-testid={`${dataTestId}-success-title`}\n          >\n            {config.successTitle}\n          </h3>\n          <p\n            style={{\n              margin: \"0\",\n              color: \"var(--leadform-muted-foreground)\",\n              fontSize: \"14px\",\n            }}\n            data-testid={`${dataTestId}-success-subtitle`}\n          >\n            {config.successSubtitle}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={`simple-leadform ${className}`}\n      data-theme={config.theme}\n      data-testid={dataTestId}\n      style={style}\n    >\n      {(config.title || config.subtitle) && (\n        <div\n          className=\"simple-leadform-header\"\n          data-testid={`${dataTestId}-header`}\n        >\n          {config.title && (\n            <h3\n              className=\"simple-leadform-title\"\n              data-testid={`${dataTestId}-title`}\n            >\n              {config.title}\n            </h3>\n          )}\n          {config.subtitle && (\n            <p\n              className=\"simple-leadform-subtitle\"\n              data-testid={`${dataTestId}-subtitle`}\n            >\n              {config.subtitle}\n            </p>\n          )}\n        </div>\n      )}\n      <form\n        className=\"simple-leadform-form\"\n        onSubmit={handleSubmit}\n        data-testid={`${dataTestId}-form`}\n      >\n        {renderFields(\n          config,\n          formData,\n          fieldErrors,\n          handleInputChange,\n          dataTestId\n        )}\n\n        {/* Honeypot field */}\n        <div\n          className=\"simple-leadform-field hidden\"\n          data-testid={`${dataTestId}-honeypot`}\n        >\n          <label\n            className=\"simple-leadform-label\"\n            htmlFor=\"simple-leadform-website\"\n          >\n            Website\n          </label>\n          <input\n            className=\"simple-leadform-input\"\n            type=\"text\"\n            name=\"website\"\n            id=\"simple-leadform-website\"\n            tabIndex={-1}\n            autoComplete=\"off\"\n          />\n        </div>\n\n        {renderConsentFields(\n          config,\n          formData,\n          fieldErrors,\n          handleInputChange,\n          showMarketingConsent,\n          dataTestId\n        )}\n\n        <button\n          type=\"submit\"\n          className={`simple-leadform-submit ${\n            isSubmitting ? \"simple-leadform-submit-loading\" : \"\"\n          }`}\n          disabled={isSubmitting}\n          data-testid={`${dataTestId}-submit-button`}\n        >\n          <span\n            className=\"simple-leadform-submit-text\"\n            data-testid={`${dataTestId}-submit-text`}\n          >\n            {config.buttonText}\n          </span>\n          <div\n            className=\"simple-leadform-spinner\"\n            style={{ display: isSubmitting ? \"block\" : \"none\" }}\n            data-testid={`${dataTestId}-submit-spinner`}\n          />\n        </button>\n      </form>\n    </div>\n  );\n};\n\n// Helper functions\nfunction normalizeColor(input?: string): string | null {\n  if (!input) return null;\n  // Allow only hex colors\n  if (/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(input)) {\n    return input;\n  }\n  return null;\n}\n\nfunction getFieldMap(\n  config: LeadFormConfig\n): Record<\n  string,\n  { label: string; type: string; placeholder: string; required: boolean }\n> {\n  return {\n    name: {\n      label: config.nameFieldLabel!,\n      type: \"text\",\n      placeholder: config.nameFieldPlaceholder!,\n      required: true,\n    },\n    email: {\n      label: config.emailFieldLabel!,\n      type: \"email\",\n      placeholder: config.emailFieldPlaceholder!,\n      required: true,\n    },\n    company: {\n      label: config.companyFieldLabel!,\n      type: \"text\",\n      placeholder: config.companyFieldPlaceholder!,\n      required: false,\n    },\n    phone: {\n      label: config.phoneFieldLabel!,\n      type: \"tel\",\n      placeholder: config.phoneFieldPlaceholder!,\n      required: false,\n    },\n    message: {\n      label: config.messageFieldLabel!,\n      type: \"textarea\",\n      placeholder: config.messageFieldPlaceholder!,\n      required: false,\n    },\n  };\n}\n\nfunction renderFields(\n  config: LeadFormConfig,\n  formData: LeadFormData,\n  fieldErrors: Record<string, string>,\n  handleInputChange: (field: string, value: string) => void,\n  dataTestId: string\n) {\n  const fieldMap = getFieldMap(config);\n\n  return config.fields\n    .map((fieldName) => {\n      const field = fieldMap[fieldName];\n      if (!field) return null;\n\n      const isTextarea = field.type === \"textarea\";\n      const fieldId = `simple-leadform-${fieldName}`;\n      const value = formData[fieldName] || \"\";\n      const error = fieldErrors[fieldName];\n\n      const commonProps = {\n        name: fieldName,\n        id: fieldId,\n        placeholder: field.placeholder,\n        required: field.required,\n        value,\n        onChange: (\n          e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n        ) => handleInputChange(fieldName, e.target.value),\n      };\n\n      return (\n        <div\n          key={fieldName}\n          className=\"simple-leadform-field\"\n          data-testid={`${dataTestId}-field-${fieldName}`}\n        >\n          <label\n            className=\"simple-leadform-label\"\n            htmlFor={fieldId}\n            data-testid={`${dataTestId}-label-${fieldName}`}\n          >\n            {field.label}\n            {field.required ? \" *\" : \"\"}\n          </label>\n          {isTextarea ? (\n            <textarea\n              {...commonProps}\n              className=\"simple-leadform-input simple-leadform-textarea\"\n              data-testid={`${dataTestId}-input-${fieldName}`}\n            />\n          ) : (\n            <input\n              {...commonProps}\n              type={field.type}\n              className=\"simple-leadform-input\"\n              data-testid={`${dataTestId}-input-${fieldName}`}\n            />\n          )}\n          {error && (\n            <div\n              className=\"simple-leadform-error\"\n              data-testid={`${dataTestId}-error-${fieldName}`}\n            >\n              {error}\n            </div>\n          )}\n        </div>\n      );\n    })\n    .filter(Boolean);\n}\n\nfunction renderConsentFields(\n  config: LeadFormConfig,\n  formData: LeadFormData,\n  fieldErrors: Record<string, string>,\n  handleInputChange: (field: string, value: string) => void,\n  showMarketingConsent: boolean,\n  dataTestId: string\n) {\n  const consentFields = [];\n\n  // Required consent\n  if (config.requireConsent) {\n    const consentError = fieldErrors.consent;\n    consentFields.push(\n      <div\n        key=\"consent\"\n        className=\"simple-leadform-field simple-leadform-checkbox-field\"\n        data-testid={`${dataTestId}-field-consent`}\n      >\n        <input\n          type=\"checkbox\"\n          id=\"simple-leadform-consent\"\n          name=\"consent\"\n          className=\"simple-leadform-checkbox\"\n          required\n          checked={formData.consent === \"true\"}\n          onChange={(e) =>\n            handleInputChange(\"consent\", e.target.checked ? \"true\" : \"false\")\n          }\n          data-testid={`${dataTestId}-checkbox-consent`}\n        />\n        <div style={{ flex: 1 }}>\n          <label\n            htmlFor=\"simple-leadform-consent\"\n            className=\"simple-leadform-checkbox-label\"\n            data-testid={`${dataTestId}-label-consent`}\n          >\n            {consentText}\n          </label>\n          {consentError && (\n            <div\n              className=\"simple-leadform-error\"\n              data-testid={`${dataTestId}-error-consent`}\n            >\n              {consentError}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Marketing consent\n  if (config.requireMarketingConsent && showMarketingConsent) {\n    consentFields.push(\n      <div\n        key=\"marketing-consent\"\n        className=\"simple-leadform-field simple-leadform-checkbox-field\"\n        data-testid={`${dataTestId}-field-marketing-consent`}\n      >\n        <input\n          type=\"checkbox\"\n          id=\"simple-leadform-marketing-consent\"\n          name=\"marketingConsent\"\n          className=\"simple-leadform-checkbox\"\n          checked={formData.marketingConsent === \"true\"}\n          onChange={(e) =>\n            handleInputChange(\n              \"marketingConsent\",\n              e.target.checked ? \"true\" : \"false\"\n            )\n          }\n          data-testid={`${dataTestId}-checkbox-marketing-consent`}\n        />\n        <label\n          htmlFor=\"simple-leadform-marketing-consent\"\n          className=\"simple-leadform-checkbox-label\"\n          data-testid={`${dataTestId}-label-marketing-consent`}\n        >\n          {marketingConsentText}\n        </label>\n      </div>\n    );\n  }\n\n  return consentFields;\n}\n\nfunction generateDeviceFingerprint(): DeviceFingerprint {\n  if (typeof window === \"undefined\") {\n    return {\n      screen: \"\",\n      timezone: \"\",\n      language: \"\",\n      platform: \"\",\n      cookieEnabled: false,\n      doNotTrack: null,\n    };\n  }\n\n  return {\n    screen: `${window.screen.width}x${window.screen.height}`,\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || \"\",\n    language: navigator.language || \"\",\n    platform: navigator.platform || \"\",\n    cookieEnabled: navigator.cookieEnabled || false,\n    doNotTrack: navigator.doNotTrack,\n  };\n}\n\nasync function getClientIP(): Promise<string | undefined> {\n  try {\n    // Try to get IP from a public service\n    const response = await fetch(\"https://api.ipify.org?format=json\");\n    const data = await response.json();\n    return data.ip;\n  } catch (error) {\n    // Fallback: try another service\n    try {\n      const response = await fetch(\"https://ipapi.co/json/\");\n      const data = await response.json();\n      return data.ip;\n    } catch (fallbackError) {\n      console.warn(\"Could not determine client IP address\");\n      return undefined;\n    }\n  }\n}\n\nasync function generateConsentEvent(\n  formData: LeadFormData,\n  config: LeadFormConfig\n): Promise<ConsentEvent | null> {\n  if (!config.requireConsent && !config.requireMarketingConsent) {\n    return null;\n  }\n\n  const ip = await getClientIP();\n\n  return {\n    timestamp: new Date().toISOString(),\n    consentGiven: true,\n    marketingConsentRequested: config.requireMarketingConsent,\n    marketingConsentText: marketingConsentText,\n    marketingConsentGiven: formData.marketingConsent === \"true\",\n    consentText: consentText,\n    ip: ip,\n    userAgent: navigator.userAgent || \"\",\n  };\n}\n\nasync function submitFormData(\n  config: LeadFormConfig,\n  formData: LeadFormData,\n  submissionStartTime: number | null,\n  mockSubmit: boolean\n) {\n  const apiEndpoint = config.apiEndpoint || \"https://api.loubase.com/v1/leads\";\n\n  // Calculate submission time if available\n  const submissionTime = submissionStartTime\n    ? Date.now() - submissionStartTime\n    : null;\n\n  const idempotencyKey = generateIdempotencyKey();\n  // Prepare submission data\n  const submissionData: CaptureLeadPayload = {\n    siteSlug: config.siteSlug,\n    sitePublicKey: config.sitePublicKey,\n    formData,\n    consentEvent: await generateConsentEvent(formData, config),\n    deviceFingerprint: generateDeviceFingerprint(),\n    source: \"react-form\",\n    timestamp: new Date().toISOString(),\n    submissionTime,\n    userAgent: typeof window !== \"undefined\" ? window.navigator.userAgent : \"\",\n    url: typeof window !== \"undefined\" ? window.location.href : \"\",\n    idempotencyKey,\n  };\n\n  if (mockSubmit) {\n    return {\n      success: true,\n      message: \"Form submitted successfully\",\n    };\n  }\n\n  try {\n    const response = await fetch(apiEndpoint, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n        \"X-Idempotency-Key\": idempotencyKey,\n      },\n      body: JSON.stringify(submissionData),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`HTTP ${response.status}: ${errorText}`);\n    }\n\n    const result = await response.json();\n    return result;\n  } catch (error) {\n    // Log error for debugging\n    console.error(\"Lead form submission error:\", error);\n    throw error;\n  }\n}\n\n// Types are exported from the main export statement above\n","/**\n * LeadForm Embeddable Widget\n * A simple floating lead capture form that can be embedded on any website\n */\n\nimport {\n  CaptureLeadPayload,\n  ConsentEvent,\n  DeviceFingerprint,\n  LeadFormData,\n  LeadFormWidgetConfig,\n  consentText,\n  generateIdempotencyKey,\n  marketingConsentText,\n  validateEmail,\n  validatePhone,\n} from './types'\nexport type EventType = 'open' | 'close' | 'submit' | 'error'\n\nclass LeadFormWidget {\n  private config: LeadFormWidgetConfig\n  private container: HTMLDivElement\n  private isVisible: boolean = false\n  private isSubmitting: boolean = false\n  private formStartTime: number = 0\n  private idempotencyKey: string = ''\n  private deviceFingerprint: DeviceFingerprint\n  private eventListeners: Map<EventType, Set<Function>> = new Map()\n  private consentText: string\n  private marketingConsentText: string\n\n  constructor(config: LeadFormWidgetConfig) {\n    this.config = this.validateConfig(config)\n    this.container = document.createElement('div')\n    this.deviceFingerprint = this.generateDeviceFingerprint()\n    this.validateOrigin()\n    this.init()\n    document.addEventListener('keydown', this.onKeydown)\n    this.consentText = consentText\n    this.marketingConsentText = marketingConsentText\n  }\n\n  private onKeydown = (e: KeyboardEvent) => {\n    if (e.key === 'Escape' && this.isVisible) {\n      this.hide()\n    }\n  }\n\n  private validateConfig(config: LeadFormWidgetConfig): LeadFormWidgetConfig {\n    if (!config.siteSlug) {\n      throw new Error('LeadForm: siteSlug is required')\n    }\n    if (!config.sitePublicKey) {\n      throw new Error('LeadForm: sitePublicKey is required')\n    }\n\n    return {\n      ...config,\n      // Set defaults for configurable text\n      subtitle:\n        config.subtitle ||\n        \"We'd love to hear from you. Send us a message and we'll respond as soon as possible.\",\n      closeButtonLabel: config.closeButtonLabel || 'Close',\n      nameFieldLabel: config.nameFieldLabel || 'Name',\n      emailFieldLabel: config.emailFieldLabel || 'Email',\n      companyFieldLabel: config.companyFieldLabel || 'Company',\n      phoneFieldLabel: config.phoneFieldLabel || 'Phone',\n      messageFieldLabel: config.messageFieldLabel || 'Message',\n      nameFieldPlaceholder: config.nameFieldPlaceholder || 'Your name',\n      emailFieldPlaceholder:\n        config.emailFieldPlaceholder || 'your.email@example.com',\n      companyFieldPlaceholder: config.companyFieldPlaceholder || 'Your company',\n      phoneFieldPlaceholder: config.phoneFieldPlaceholder || '(555) 123-4567',\n      messageFieldPlaceholder:\n        config.messageFieldPlaceholder || 'Tell us about your project...',\n      successTitle: config.successTitle || config.successMessage || 'Success',\n      successSubtitle: config.successSubtitle || \"We'll get back to you soon!\",\n    }\n  }\n\n  private validateOrigin(): void {\n    const origin = window.location.origin\n    const protocol = window.location.protocol\n\n    if (\n      protocol !== 'https:' &&\n      protocol !== 'http:' &&\n      origin !== 'http://localhost:3000'\n    ) {\n      console.warn('LeadForm: HTTPS is required for production use')\n    }\n  }\n\n  private generateDeviceFingerprint(): DeviceFingerprint {\n    return {\n      screen: `${screen.width}x${screen.height}`,\n      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n      language: navigator.language,\n      platform: navigator.platform,\n      cookieEnabled: navigator.cookieEnabled,\n      doNotTrack: navigator.doNotTrack,\n    }\n  }\n\n  private emit(event: EventType, data?: any): void {\n    const listeners = this.eventListeners.get(event)\n    if (listeners) {\n      listeners.forEach(callback => {\n        try {\n          callback(data)\n        } catch (error) {\n          console.error(`Error in ${event} event listener:`, error)\n        }\n      })\n    }\n  }\n\n  public on(event: EventType, callback: Function): void {\n    if (!this.eventListeners.has(event)) {\n      this.eventListeners.set(event, new Set())\n    }\n    this.eventListeners.get(event)!.add(callback)\n  }\n\n  public off(event: EventType, callback: Function): void {\n    const listeners = this.eventListeners.get(event)\n    if (listeners) {\n      listeners.delete(callback)\n    }\n  }\n\n  private init(): void {\n    this.injectStyles()\n    this.createForm()\n    this.createFloatingTrigger()\n    this.attachEventListeners()\n\n    document.body.appendChild(this.container)\n  }\n\n  private injectStyles(): void {\n    // Check if styles are already injected\n    if (document.getElementById('leadform-widget-styles')) {\n      return\n    }\n\n    const style = document.createElement('style')\n    style.id = 'leadform-widget-styles'\n    const accentColor =\n      this.normalizeColor(this.config.accentColorHex) || '#3b82f6'\n\n    style.textContent = `\n      .leadform-widget {\n        --leadform-primary: ${accentColor};\n        --leadform-primary-foreground: #ffffff;\n        --leadform-background: #ffffff;\n        --leadform-foreground: #0f172a;\n        --leadform-muted: #f8fafc;\n        --leadform-muted-foreground: #64748b;\n        --leadform-border: #e2e8f0;\n        --leadform-input: #ffffff;\n        --leadform-ring: var(--leadform-primary);\n        --leadform-destructive: #ef4444;\n        --leadform-destructive-foreground: #ffffff;\n        \n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n        font-size: 14px;\n        line-height: 1.5;\n        color: var(--leadform-foreground);\n        box-sizing: border-box;\n      }\n\n      @media (prefers-color-scheme: dark) {\n        .leadform-widget[data-theme=\"auto\"] {\n          --leadform-background: #0f172a;\n          --leadform-foreground: #f8fafc;\n          --leadform-muted: #1e293b;\n          --leadform-muted-foreground: #94a3b8;\n          --leadform-border: #334155;\n          --leadform-input: #1e293b;\n        }\n      }\n\n      .leadform-widget[data-theme=\"dark\"] {\n        --leadform-background: #0f172a;\n        --leadform-foreground: #f8fafc;\n        --leadform-muted: #1e293b;\n        --leadform-muted-foreground: #94a3b8;\n        --leadform-border: #334155;\n        --leadform-input: #1e293b;\n      }\n\n      .leadform-widget * {\n        box-sizing: border-box;\n      }\n\n      .leadform-container {\n        position: fixed;\n        z-index: 999999;\n        background: var(--leadform-background);\n        border: 1px solid var(--leadform-border);\n        border-radius: 8px;\n        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n        padding: 24px;\n        width: 320px;\n        max-width: calc(100vw - 32px);\n        max-height: calc(100vh - 32px);\n        overflow-y: auto;\n        transform: translateY(100%);\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        pointer-events: none;\n        visibility: hidden;\n      }\n\n      .leadform-container.visible {\n        transform: translateY(0);\n        opacity: 1;\n        pointer-events: auto;\n        visibility: visible;\n      }\n\n      .leadform-container.bottom-right {\n        bottom: 16px;\n        right: 16px;\n      }\n\n      .leadform-container.bottom-left {\n        bottom: 16px;\n        left: 16px;\n      }\n\n      .leadform-container.top-right {\n        top: 16px;\n        right: 16px;\n        transform: translateY(-100%);\n      }\n\n      .leadform-container.top-right.visible {\n        transform: translateY(0);\n      }\n\n      .leadform-container.top-left {\n        top: 16px;\n        left: 16px;\n        transform: translateY(-100%);\n      }\n\n      .leadform-container.top-left.visible {\n        transform: translateY(0);\n      }\n\n      .leadform-container.center {\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0.95);\n      }\n\n      .leadform-container.center.visible {\n        transform: translate(-50%, -50%) scale(1);\n      }\n\n      .leadform-trigger {\n        position: fixed;\n        bottom: 24px;\n        right: 24px;\n        width: 56px;\n        height: 56px;\n        border-radius: 50%;\n        background: var(--leadform-primary);\n        color: var(--leadform-primary-foreground);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: all 0.3s ease;\n        z-index: 999998;\n      }\n\n      .leadform-trigger:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);\n      }\n\n      .leadform-header {\n        margin-bottom: 24px;\n        text-align: left;\n      }\n\n      .leadform-title {\n        font-size: 18px;\n        font-weight: 600;\n        margin: 0 0 8px 0;\n        color: var(--leadform-foreground);\n      }\n\n      .leadform-subtitle {\n        font-size: 14px;\n        color: var(--leadform-muted-foreground);\n        margin: 0;\n        line-height: 1.4;\n      }\n\n      .leadform-close {\n        position: absolute;\n        top: 12px;\n        right: 12px;\n        background: none;\n        border: none;\n        color: var(--leadform-muted-foreground);\n        cursor: pointer;\n        padding: 4px;\n        border-radius: 4px;\n        transition: color 0.2s ease;\n      }\n\n      .leadform-close:hover {\n        color: var(--leadform-foreground);\n      }\n\n      .leadform-form {\n        display: flex;\n        flex-direction: column;\n        gap: 20px;\n      }\n\n      .leadform-field {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n\n      .leadform-field.hidden {\n        position: absolute;\n        left: -9999px;\n        opacity: 0;\n        pointer-events: none;\n      }\n\n      .leadform-label {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--leadform-foreground);\n      }\n\n      .leadform-input {\n        padding: 12px 16px;\n        border: 1px solid var(--leadform-border);\n        border-radius: 8px;\n        background: var(--leadform-input);\n        color: var(--leadform-foreground);\n        font-size: 14px;\n        transition: border-color 0.2s ease, box-shadow 0.2s ease;\n      }\n\n      .leadform-input:focus {\n        outline: none;\n        border-color: var(--leadform-ring);\n        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n      }\n\n      .leadform-textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n\n      .leadform-checkbox-field {\n        flex-direction: row;\n        align-items: flex-start;\n        gap: 12px;\n      }\n\n      .leadform-checkbox {\n        margin-top: 2px;\n        width: 16px;\n        height: 16px;\n      }\n\n      .leadform-checkbox-label {\n        font-size: 12px;\n        color: var(--leadform-muted-foreground);\n        line-height: 1.4;\n      }\n\n      .leadform-submit {\n        background: var(--leadform-primary);\n        color: var(--leadform-primary-foreground);\n        border: none;\n        padding: 12px 24px;\n        border-radius: 6px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: background-color 0.2s ease;\n        position: relative;\n        margin-top: 8px;\n      }\n\n      .leadform-submit:hover:not(:disabled) {\n        filter: brightness(0.9);\n      }\n\n      .leadform-submit:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .leadform-submit-loading {\n        color: transparent;\n      }\n\n      .leadform-spinner {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 16px;\n        height: 16px;\n        border: 2px solid transparent;\n        border-top: 2px solid var(--leadform-primary-foreground);\n        border-radius: 50%;\n        animation: leadform-spin 1s linear infinite;\n      }\n\n      @keyframes leadform-spin {\n        0% { transform: translate(-50%, -50%) rotate(0deg); }\n        100% { transform: translate(-50%, -50%) rotate(360deg); }\n      }\n\n      .leadform-success {\n        text-align: center;\n        padding: 20px;\n        color: var(--leadform-foreground);\n      }\n\n      .leadform-error {\n        color: var(--leadform-destructive);\n        font-size: 12px;\n        margin-top: 4px;\n      }\n\n      @media (max-width: 480px) {\n        .leadform-container {\n          width: calc(100vw - 32px);\n          margin: 16px;\n        }\n        \n        .leadform-container.bottom-right,\n        .leadform-container.bottom-left {\n          bottom: 0;\n          left: 16px;\n          right: 16px;\n          width: auto;\n        }\n      }\n    `\n    document.head.appendChild(style)\n  }\n\n  private normalizeColor(input?: string): string | null {\n    if (!input) return null\n    // Allow only hex colors (#rgb, #rrggbb, #rrggbbaa)\n    if (/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(input)) {\n      return input\n    }\n    // Use the browser to validate/normalize\n    const el = document.createElement('div')\n    el.style.color = ''\n    el.style.color = input\n    return el.style.color ? getComputedStyle(el).color : null\n  }\n\n  private createForm(): void {\n    this.formStartTime = Date.now()\n    this.idempotencyKey = generateIdempotencyKey()\n\n    this.container.className = 'leadform-widget'\n    this.container.setAttribute('data-theme', this.config.theme)\n\n    const formContainer = document.createElement('div')\n    formContainer.className = `leadform-container ${this.config.position}`\n\n    const honeypotField = `\n      <div class=\"leadform-field hidden\">\n        <label class=\"leadform-label\" for=\"leadform-website\">Website</label>\n        <input class=\"leadform-input\" type=\"text\" name=\"website\" id=\"leadform-website\" tabindex=\"-1\" autocomplete=\"off\">\n      </div>\n    `\n\n    const consentFields = this.generateConsentFields()\n\n    formContainer.innerHTML = `\n      <button class=\"leadform-close\" type=\"button\" aria-label=\"${this.config.closeButtonLabel}\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n          <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n        </svg>\n      </button>\n      <div class=\"leadform-header\">\n        <h3 class=\"leadform-title\">${this.config.title}</h3>\n        <p class=\"leadform-subtitle\">${this.config.subtitle}</p>\n      </div>\n      <form class=\"leadform-form\">\n        ${this.generateFields()}\n        ${honeypotField}\n        ${consentFields}\n        <button type=\"submit\" class=\"leadform-submit\">\n          <span class=\"leadform-submit-text\">${this.config.buttonText}</span>\n          <div class=\"leadform-spinner\" style=\"display: none;\"></div>\n        </button>\n      </form>\n    `\n\n    this.container.appendChild(formContainer)\n  }\n\n  private generateConsentFields(): string {\n    let consentFields = ''\n\n    // Required consent (privacy/data handling)\n    if (this.config.requireConsent) {\n      consentFields += `\n        <div class=\"leadform-field leadform-checkbox-field\">\n          <input type=\"checkbox\" id=\"leadform-consent\" name=\"consent\" class=\"leadform-checkbox\" required>\n          <label for=\"leadform-consent\" class=\"leadform-checkbox-label\">\n            ${this.consentText}\n          </label>\n        </div>\n      `\n    }\n\n    // Marketing consent (optional)\n    if (this.config.requireMarketingConsent) {\n      consentFields += `\n        <div class=\"leadform-field leadform-checkbox-field\" id=\"leadform-marketing-consent-field\" style=\"display: none;\">\n          <input type=\"checkbox\" id=\"leadform-marketing-consent\" name=\"marketingConsent\" class=\"leadform-checkbox\" checked>\n          <label for=\"leadform-marketing-consent\" class=\"leadform-checkbox-label\">\n            ${this.marketingConsentText}\n          </label>\n        </div>\n      `\n    }\n\n    return consentFields\n  }\n\n  private generateFields(): string {\n    const fieldMap: Record<\n      string,\n      { label: string; type: string; placeholder: string; required: boolean }\n    > = {\n      name: {\n        label: this.config.nameFieldLabel!,\n        type: 'text',\n        placeholder: this.config.nameFieldPlaceholder!,\n        required: true,\n      },\n      email: {\n        label: this.config.emailFieldLabel!,\n        type: 'email',\n        placeholder: this.config.emailFieldPlaceholder!,\n        required: true,\n      },\n      company: {\n        label: this.config.companyFieldLabel!,\n        type: 'text',\n        placeholder: this.config.companyFieldPlaceholder!,\n        required: false,\n      },\n      phone: {\n        label: this.config.phoneFieldLabel!,\n        type: 'tel',\n        placeholder: this.config.phoneFieldPlaceholder!,\n        required: false,\n      },\n      message: {\n        label: this.config.messageFieldLabel!,\n        type: 'textarea',\n        placeholder: this.config.messageFieldPlaceholder!,\n        required: false,\n      },\n    }\n\n    return this.config.fields\n      .map(fieldName => {\n        const field = fieldMap[fieldName]\n        if (!field) return ''\n\n        const isTextarea = field.type === 'textarea'\n        const fieldId = `leadform-${fieldName}`\n        const inputElement = isTextarea\n          ? `<textarea class=\"leadform-input leadform-textarea\" name=\"${fieldName}\" id=\"${fieldId}\" placeholder=\"${field.placeholder}\" ${field.required ? 'required' : ''}></textarea>`\n          : `<input class=\"leadform-input\" type=\"${field.type}\" name=\"${fieldName}\" id=\"${fieldId}\" placeholder=\"${field.placeholder}\" ${field.required ? 'required' : ''}>`\n\n        return `\n        <div class=\"leadform-field\">\n          <label class=\"leadform-label\" for=\"${fieldId}\">${field.label}${field.required ? ' *' : ''}</label>\n          ${inputElement}\n          <div class=\"leadform-error\" id=\"${fieldId}-error\"></div>\n        </div>\n      `\n      })\n      .join('')\n  }\n\n  private createFloatingTrigger(): void {\n    const trigger = document.createElement('button')\n    trigger.className = 'leadform-trigger'\n    trigger.innerHTML = `\n      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n      </svg>\n    `\n    trigger.setAttribute('aria-label', 'Open contact form')\n\n    trigger.addEventListener('click', () => this.toggle())\n    this.container.appendChild(trigger)\n  }\n\n  private attachEventListeners(): void {\n    const form = this.container.querySelector(\n      '.leadform-form'\n    ) as HTMLFormElement\n    const closeButton = this.container.querySelector(\n      '.leadform-close'\n    ) as HTMLButtonElement\n\n    if (closeButton) {\n      closeButton.addEventListener('click', () => this.hide())\n    }\n\n    if (form) {\n      form.addEventListener('submit', e => this.handleSubmit(e))\n    }\n\n    // Listen for email input changes to show/hide marketing consent\n    if (this.config.requireMarketingConsent) {\n      const emailInput = this.container.querySelector(\n        'input[name=\"email\"]'\n      ) as HTMLInputElement\n      if (emailInput) {\n        emailInput.addEventListener('input', () => this.handleEmailChange())\n        emailInput.addEventListener('blur', () => this.handleEmailChange())\n      }\n    }\n  }\n\n  private handleEmailChange(): void {\n    const emailInput = this.container.querySelector(\n      'input[name=\"email\"]'\n    ) as HTMLInputElement\n    const marketingConsentField = this.container.querySelector(\n      '#leadform-marketing-consent-field'\n    ) as HTMLDivElement\n\n    if (!emailInput || !marketingConsentField) return\n\n    const email = emailInput.value\n    const isValidEmail = validateEmail(email)\n\n    if (isValidEmail) {\n      marketingConsentField.style.display = 'flex'\n    } else {\n      marketingConsentField.style.display = 'none'\n    }\n  }\n\n  private async handleSubmit(e: Event): Promise<void> {\n    e.preventDefault()\n\n    if (this.isSubmitting) return\n\n    const form = e.target as HTMLFormElement\n    const formData = new FormData(form)\n    const data: LeadFormData = {}\n\n    // Clear previous errors\n    this.clearErrors()\n\n    // Check honeypot field\n    const honeypotValue = formData.get('website') as string\n    if (honeypotValue && honeypotValue.trim() !== '') {\n      console.warn('LeadForm: Honeypot field filled, likely spam')\n      this.showError('Honeypot field filled')\n      this.emit('error', { type: 'honeypot', message: 'Honeypot field filled' })\n      return\n    }\n\n    // Check submission timing\n    const submissionTime = Date.now() - this.formStartTime\n    if (submissionTime < 3000) {\n      console.warn('LeadForm: Form submitted too quickly, likely spam')\n      this.showError('Form submitted too quickly')\n      this.emit('error', {\n        type: 'timing',\n        message: 'Form submitted too quickly',\n      })\n      return\n    }\n\n    // Get marketing consent status\n    const marketingConsentGiven = formData.get('marketingConsent') === 'on'\n\n    // Collect form data (excluding honeypot and consent checkboxes)\n    formData.forEach((value, key) => {\n      if (\n        key !== 'consent' &&\n        key !== 'marketingConsent' &&\n        key !== 'website'\n      ) {\n        data[key] = value as string\n      }\n    })\n\n    // Basic validation\n    if (!this.validateForm(data)) {\n      this.emit('error', {\n        type: 'validation',\n        message: 'Form validation failed',\n      })\n      return\n    }\n\n    this.setSubmitting(true)\n\n    try {\n      const result = await this.submitLead(\n        data,\n        this.config.requireConsent\n          ? {\n              timestamp: new Date().toISOString(),\n              userAgent: navigator.userAgent,\n              consentGiven: true,\n              marketingConsentRequested: this.config.requireMarketingConsent,\n              consentText: this.consentText,\n              marketingConsentText: this.marketingConsentText,\n              marketingConsentGiven,\n            }\n          : null\n      )\n\n      this.emit('submit', { data, result })\n      this.showSuccess()\n      // Auto-hide after success\n      setTimeout(() => this.hide(), 3000)\n    } catch (error) {\n      this.showError('Failed to submit form')\n      this.emit('error', {\n        type: 'submission',\n        message: 'Failed to submit form',\n        error,\n      })\n      console.error('Lead form submission error:', error)\n    } finally {\n      this.setSubmitting(false)\n    }\n  }\n\n  private validateForm(data: LeadFormData): boolean {\n    let isValid = true\n\n    // Check if form includes email and/or phone fields\n    const hasEmailField = this.config.fields.includes('email')\n    const hasPhoneField = this.config.fields.includes('phone')\n\n    // Individual field validation\n    this.config.fields.forEach(fieldName => {\n      const fieldMap: Record<\n        string,\n        { required: boolean; validate?: (value: string) => boolean }\n      > = {\n        name: { required: true },\n        email: {\n          required: true,\n          validate: (value: string) => validateEmail(value),\n        },\n        company: { required: false },\n        phone: {\n          required: false,\n          validate: (value: string) => validatePhone(value),\n        },\n        message: { required: false },\n      }\n\n      const field = fieldMap[fieldName]\n      const value = data[fieldName] || ''\n\n      // Skip required check for email and phone if we need to validate them together\n      const skipRequiredCheck =\n        (fieldName === 'email' || fieldName === 'phone') &&\n        hasEmailField &&\n        hasPhoneField\n\n      if (field?.required && !skipRequiredCheck && !value.trim()) {\n        this.showFieldError(fieldName, 'This field is required')\n        isValid = false\n      } else if (value && field?.validate && !field.validate(value)) {\n        if (fieldName === 'email') {\n          this.showFieldError(fieldName, 'Please enter a valid email address')\n        } else if (fieldName === 'phone') {\n          this.showFieldError(fieldName, 'Please enter a valid phone number')\n        }\n        isValid = false\n      }\n    })\n\n    // Special validation: if both email and phone are present, require at least one\n    if (hasEmailField && hasPhoneField) {\n      const email = data.email || ''\n      const phone = data.phone || ''\n\n      const hasValidEmail = email.trim() && validateEmail(email)\n      const hasValidPhone = phone.trim() && validatePhone(phone)\n\n      if (!hasValidEmail && !hasValidPhone) {\n        this.showFieldError(\n          'email',\n          'Please provide either a valid email or phone number'\n        )\n        this.showFieldError(\n          'phone',\n          'Please provide either a valid email or phone number'\n        )\n        isValid = false\n      }\n    }\n\n    return isValid\n  }\n\n  private showFieldError(fieldName: string, message: string): void {\n    const errorElement = this.container.querySelector(\n      `#leadform-${fieldName}-error`\n    ) as HTMLDivElement\n    if (errorElement) {\n      errorElement.textContent = message\n    }\n  }\n\n  private clearErrors(): void {\n    const errorElements = this.container.querySelectorAll('.leadform-error')\n    errorElements.forEach(element => {\n      element.textContent = ''\n    })\n  }\n\n  private showError(message: string): void {\n    console.error(message)\n  }\n\n  private setSubmitting(isSubmitting: boolean): void {\n    this.isSubmitting = isSubmitting\n    const submitButton = this.container.querySelector(\n      '.leadform-submit'\n    ) as HTMLButtonElement\n    const spinner = this.container.querySelector(\n      '.leadform-spinner'\n    ) as HTMLDivElement\n\n    if (submitButton) {\n      submitButton.disabled = isSubmitting\n      if (isSubmitting) {\n        submitButton.classList.add('leadform-submit-loading')\n        spinner.style.display = 'block'\n      } else {\n        submitButton.classList.remove('leadform-submit-loading')\n        spinner.style.display = 'none'\n      }\n    }\n  }\n\n  private async submitLead(\n    data: LeadFormData,\n    consentEvent: ConsentEvent | null\n  ): Promise<void> {\n    const apiEndpoint =\n      this.config.apiEndpoint || 'https://api.loubase.com/leads'\n\n    const payload: CaptureLeadPayload = {\n      siteSlug: this.config.siteSlug,\n      sitePublicKey: this.config.sitePublicKey,\n      formData: data,\n      source: 'embed',\n      timestamp: new Date().toISOString(),\n      url: window.location.href,\n      userAgent: navigator.userAgent,\n      deviceFingerprint: this.deviceFingerprint,\n      consentEvent,\n      submissionTime: Date.now() - this.formStartTime,\n      idempotencyKey: this.idempotencyKey,\n    }\n\n    const response = await fetch(apiEndpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Idempotency-Key': this.idempotencyKey,\n      },\n      body: JSON.stringify(payload),\n    })\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`)\n    }\n\n    return response.json()\n  }\n\n  private showSuccess(): void {\n    const formContainer = this.container.querySelector(\n      '.leadform-container'\n    ) as HTMLDivElement\n    formContainer.innerHTML = `\n      <button class=\"leadform-close\" aria-label=\"${this.config.closeButtonLabel}\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n          <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n        </svg>\n      </button>\n      <div class=\"leadform-success\">\n        <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"margin: 0 auto 16px; color: #22c55e;\">\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n          <polyline points=\"22,4 12,14.01 9,11.01\"></polyline>\n        </svg>\n        <h3 style=\"margin: 0 0 8px 0;\">${this.config.successTitle}</h3>\n        <p style=\"margin: 0; color: var(--leadform-muted-foreground); font-size: 14px;\">${this.config.successSubtitle}</p>\n      </div>\n    `\n\n    // Attach close event listener for the success message\n    const closeButton = this.container.querySelector(\n      '.leadform-close'\n    ) as HTMLButtonElement\n    if (closeButton) {\n      closeButton.addEventListener('click', () => this.hide())\n    }\n  }\n\n  public show(): void {\n    const formContainer = this.container.querySelector(\n      '.leadform-container'\n    ) as HTMLDivElement\n    if (formContainer) {\n      formContainer.classList.add('visible')\n      formContainer.setAttribute('aria-hidden', 'false')\n      formContainer.setAttribute('role', 'dialog')\n      formContainer.setAttribute('aria-modal', 'true')\n    }\n\n    this.isVisible = true\n    this.emit('open')\n  }\n\n  public hide(): void {\n    const formContainer = this.container.querySelector(\n      '.leadform-container'\n    ) as HTMLDivElement\n    if (formContainer) {\n      formContainer.classList.remove('visible')\n      formContainer.setAttribute('aria-hidden', 'true')\n    }\n\n    this.isVisible = false\n    this.emit('close')\n  }\n\n  public toggle(): void {\n    if (this.isVisible) {\n      this.hide()\n    } else {\n      this.show()\n    }\n  }\n\n  public destroy(): void {\n    document.removeEventListener('keydown', this.onKeydown)\n\n    if (this.container.parentNode) {\n      this.container.parentNode.removeChild(this.container)\n    }\n\n    // Remove styles if no other widgets exist\n    const existingWidgets = document.querySelectorAll('.leadform-widget')\n    if (existingWidgets.length === 0) {\n      const styleElement = document.getElementById('leadform-widget-styles')\n      if (styleElement) {\n        styleElement.remove()\n      }\n    }\n\n    this.eventListeners.clear()\n  }\n}\n\n// Global API\ndeclare global {\n  interface Window {\n    LeadFormWidget: typeof LeadFormWidget\n    LeadForm: {\n      open: () => void\n      close: () => void\n      on: (event: EventType, callback: Function) => void\n      destroy: () => void\n      version: string\n    }\n  }\n}\n\n// Global instance\nlet globalWidget: LeadFormWidget | null = null\n\n// Export LeadFormWidget for direct use\nwindow.LeadFormWidget = LeadFormWidget\n\nwindow.LeadForm = {\n  open: () => {\n    if (!globalWidget) {\n      const config = getConfigFromScript()\n      if (config) {\n        globalWidget = new LeadFormWidget(config)\n      }\n    }\n    globalWidget?.show()\n  },\n\n  close: () => {\n    globalWidget?.hide()\n  },\n\n  on: (event: EventType, callback: Function) => {\n    globalWidget?.on(event, callback)\n  },\n\n  destroy: () => {\n    globalWidget?.destroy()\n    globalWidget = null\n  },\n\n  version: '1.0.0',\n}\n\nfunction getConfigFromScript(): LeadFormWidgetConfig | null {\n  const scripts = document.querySelectorAll('script[data-site-id]')\n  const script = scripts[scripts.length - 1] as HTMLScriptElement\n\n  if (!script || !script.dataset.siteId) return null\n\n  if (!script.dataset.siteSlug || !script.dataset.sitePublicKey) return null\n\n  return {\n    siteSlug: script.dataset.siteSlug,\n    sitePublicKey: script.dataset.sitePublicKey,\n    theme: (script.dataset.theme as LeadFormWidgetConfig['theme']) || 'auto',\n    position:\n      (script.dataset.position as LeadFormWidgetConfig['position']) ||\n      'bottom-right',\n    fields: script.dataset.fields?.split(',') || ['name', 'email', 'message'],\n    title: script.dataset.title || 'Get in touch',\n    buttonText: script.dataset.buttonText || 'Contact us',\n    successMessage:\n      script.dataset.successMessage || \"Thanks — we'll reply ASAP.\",\n    requireConsent: script.dataset.requireConsent === 'true',\n    requireMarketingConsent: script.dataset.requireMarketingConsent === 'true',\n    accentColorHex: script.dataset.accentColorHex || '#3b82f6',\n    // configurable text fields\n    subtitle: script.dataset.subtitle,\n    closeButtonLabel: script.dataset.closeButtonLabel,\n    nameFieldLabel: script.dataset.nameFieldLabel,\n    emailFieldLabel: script.dataset.emailFieldLabel,\n    companyFieldLabel: script.dataset.companyFieldLabel,\n    phoneFieldLabel: script.dataset.phoneFieldLabel,\n    messageFieldLabel: script.dataset.messageFieldLabel,\n    nameFieldPlaceholder: script.dataset.nameFieldPlaceholder,\n    emailFieldPlaceholder: script.dataset.emailFieldPlaceholder,\n    companyFieldPlaceholder: script.dataset.companyFieldPlaceholder,\n    phoneFieldPlaceholder: script.dataset.phoneFieldPlaceholder,\n    messageFieldPlaceholder: script.dataset.messageFieldPlaceholder,\n    successTitle: script.dataset.successTitle,\n    successSubtitle: script.dataset.successSubtitle,\n    apiEndpoint: script.dataset.apiEndpoint,\n  }\n}\n\n// Auto-initialization from script tag attributes\nfunction initFromScript(): void {\n  const config = getConfigFromScript()\n  if (!config) return\n\n  globalWidget = new LeadFormWidget(config)\n}\n\n// Auto-init if DOM is ready, otherwise wait\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initFromScript)\n} else {\n  initFromScript()\n}\n\nexport { LeadFormWidget, type LeadFormData, type LeadFormWidgetConfig }\nexport { SimpleLeadForm } from './simple-form'\nexport type { SimpleLeadFormProps } from './simple-form'\n"],"mappings":"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","names":["consentText","marketingConsentText","generateIdempotencyKey","validateEmail","email","validatePhone","phone","digits","isValid","sequentialPatterns","pattern","useCallback","useEffect","useRef","useState","jsx","jsxs","DEFAULT_CONFIG","SimpleLeadForm","siteSlug","sitePublicKey","onSubmit","onError","className","style","showSuccessMessage","dataTestId","mockSubmit","configOverrides","isSubmitting","setIsSubmitting","useState","isSuccess","setIsSuccess","fieldErrors","setFieldErrors","formData","setFormData","showMarketingConsent","setShowMarketingConsent","submissionStartTime","setSubmissionStartTime","stylesInjectedRef","useRef","config","useEffect","accentColor","normalizeColor","handleInputChange","useCallback","field","value","prev","isValidEmail","validateEmail","handleSubmit","e","_a","_b","_c","_d","_e","_f","_g","_h","errors","fieldMap","getFieldMap","fieldName","hasEmailField","hasPhoneField","validatePhone","isValidPhone","response","submitFormData","error","errorData","renderFields","renderConsentFields","input","isTextarea","fieldId","commonProps","consentFields","consentError","consentText","marketingConsentText","generateDeviceFingerprint","getClientIP","fallbackError","generateConsentEvent","ip","apiEndpoint","submissionTime","idempotencyKey","generateIdempotencyKey","submissionData","errorText","LeadFormWidget","config","consentText","marketingConsentText","origin","protocol","event","data","listeners","callback","error","style","accentColor","input","el","generateIdempotencyKey","formContainer","honeypotField","consentFields","fieldMap","fieldName","field","isTextarea","fieldId","inputElement","trigger","form","closeButton","e","emailInput","marketingConsentField","email","validateEmail","formData","honeypotValue","marketingConsentGiven","value","key","result","isValid","hasEmailField","hasPhoneField","validatePhone","skipRequiredCheck","phone","hasValidEmail","hasValidPhone","message","errorElement","element","isSubmitting","submitButton","spinner","consentEvent","apiEndpoint","payload","response","styleElement","globalWidget","getConfigFromScript","_a","scripts","script","initFromScript"]}